generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model carriers {
  id                   String                @id @default(cuid()) @db.VarChar(20)
  name                 String                @unique @db.VarChar(100)
  contact_name         String?               @db.VarChar(100)
  contact_email        String?               @db.VarChar(100)
  contact_phone        String?               @db.VarChar(20)
  rating               Float?                @default(0) @db.Float
  status               carriers_status       @default(Active)
  id_number            String?               @db.VarChar(50)
  vehicle_registration String?               @db.VarChar(20)
  created_at           DateTime              @default(now()) @db.DateTime(0)
  updated_at           DateTime              @updatedAt @db.DateTime(0)
  carrier_assignments  carrier_assignments[]
  shipments            shipments[]

  @@map("carriers")
}

model Employee {
  id          String       @id @default(cuid())
  name        String
  email       String
  role        String
  status      String
  performance String?
  rating      Int?
  contract    String
  salary      String?
  image       String?
  id_number   String?
  phone       String?
  issue_date  DateTime?
  expiry_date DateTime?
  company     String?
  created_at  DateTime     @default(now())
  updated_at  DateTime     @updatedAt
  attendance  Attendance[]

  @@map("employees")
}

model Attendance {
  id           String    @id @default(cuid())
  employeeId   String
  date         String
  status       String
  clockInTime  DateTime?
  clockOutTime DateTime?
  designation  String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  employee     Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, date])
  @@map("attendance")
}

model accounts_receivable {
  id           String                           @id @default(cuid()) @db.VarChar(20)
  customer_id  String?                          @db.VarChar(20)
  invoice_id   String?                          @db.VarChar(100)
  amount       Decimal?                         @db.Decimal(12, 2)
  due_date     DateTime?                        @db.Date
  aging_status accounts_receivable_aging_status
  created_at   DateTime                         @default(now()) @db.DateTime(0)
  customers    customers?                       @relation(fields: [customer_id], references: [id], onDelete: Restrict, onUpdate: Restrict)

  @@index([customer_id], map: "customer_id_idx")
  @@map("accounts_receivable")
}

model activity_logs {
  id         String               @id @default(cuid()) @db.VarChar(20)
  user       String?              @db.VarChar(100)
  avatar     String?              @db.VarChar(255)
  action     String?              @db.Text
  ip         String?              @db.VarChar(45)
  timestamp  DateTime?            @db.DateTime(0)
  status     activity_logs_status
  created_at DateTime             @default(now()) @db.DateTime(0)

  @@map("activity_logs")
}

model anomalies {
  id                 Int       @id @default(autoincrement())
  metric_name        String?   @db.VarChar(100)
  metric_value       Decimal?  @db.Decimal(10, 2)
  expected_value     Decimal?  @db.Decimal(10, 2)
  timestamp          DateTime? @db.DateTime(0)
  additional_context String?   @db.Text
  created_at         DateTime  @default(now()) @db.DateTime(0)

  @@map("anomalies")
}

model cold_room_inventory {
  id                String                       @id @default(cuid()) @db.VarChar(20)
  product           String                       @db.VarChar(100)
  category          cold_room_inventory_category
  quantity          Int?
  unit              cold_room_inventory_unit
  location          String?                      @db.VarChar(100)
  entry_date        DateTime?                    @db.DateTime(0)
  current_weight    Decimal?                     @db.Decimal(10, 2)
  reorder_threshold Decimal?                     @db.Decimal(10, 2)
  created_at        DateTime                     @default(now()) @db.DateTime(0)

  @@map("cold_room_inventory")
}

model cold_rooms {
  id          String                @id @default(cuid()) @db.VarChar(20)
  name        String                @db.VarChar(100)
  temperature Decimal?              @db.Decimal(4, 1)
  humidity    Decimal?              @db.Decimal(4, 1)
  status      cold_rooms_status
  zone_type   cold_rooms_zone_type?
  created_at  DateTime              @default(now()) @db.DateTime(0)

  @@map("cold_rooms")
}

model customer_contacts {
  id          Int        @id @default(autoincrement())
  customer_id String?    @db.VarChar(20)
  name        String     @db.VarChar(100)
  role        String?    @db.VarChar(100)
  email       String?    @db.VarChar(100)
  phone       String?    @db.VarChar(20)
  is_primary  Boolean?   @default(false)
  customers   customers? @relation(fields: [customer_id], references: [id], onDelete: Cascade, onUpdate: Restrict)

  @@index([customer_id], map: "customer_id_idx")
  @@map("customer_contacts")
}

model customers {
  id                  String                @id @default(cuid()) @db.VarChar(20)
  name                String                @db.VarChar(100)
  location            String?               @db.VarChar(100)
  tags                String?               @db.LongText
  logo_url            String?               @db.VarChar(255)
  website             String?               @db.VarChar(100)
  ytd_sales           Decimal?              @db.Decimal(12, 2)
  last_order          DateTime?             @db.Date
  status              customers_status
  outstanding_balance Decimal?              @default(0.00) @db.Decimal(12, 2)
  open_invoices       Int?                  @default(0)
  created_at          DateTime              @default(now()) @db.DateTime(0)
  accounts_receivable accounts_receivable[]
  customer_contacts   customer_contacts[]
  quotes              quotes[]
  shipments           shipments[]

  @@map("customers")
}

model dwell_times {
  id              String             @id @default(cuid()) @db.VarChar(20)
  location        String?            @db.VarChar(100)
  primary_product String?            @db.VarChar(100)
  avg_dwell_time  String?            @db.VarChar(50)
  items           Int?
  status          dwell_times_status
  next_action     String?            @db.Text
  entry_date      DateTime?          @db.DateTime(0)
  weight          Decimal?           @db.Decimal(10, 2)
  created_at      DateTime           @default(now()) @db.DateTime(0)

  @@map("dwell_times")
}

model products {
  id           String            @id @default(cuid()) @db.VarChar(20)
  name         String            @db.VarChar(100)
  variety      String?           @db.VarChar(100)
  storage_temp Decimal?          @db.Decimal(4, 1)
  category     products_category
  created_at   DateTime          @default(now()) @db.DateTime(0)

  @@map("products")
}

model quotes {
  id          String        @id @default(cuid()) @db.VarChar(20)
  quote_id    String?       @unique @db.VarChar(100)
  customer_id String?       @db.VarChar(20)
  date        DateTime?     @db.Date
  valid_until DateTime?     @db.Date
  amount      Decimal?      @db.Decimal(12, 2)
  status      quotes_status
  created_at  DateTime      @default(now()) @db.DateTime(0)
  customers   customers?    @relation(fields: [customer_id], references: [id], onDelete: Restrict, onUpdate: Restrict)

  @@index([customer_id], map: "customer_id_idx")
  @@map("quotes")
}

model shipments {
  id               String           @id @default(cuid()) @db.VarChar(20)
  shipment_id      String           @unique @db.VarChar(50)
  customer_id      String?          @db.VarChar(20)
  origin           String?          @db.VarChar(100)
  destination      String?          @db.VarChar(100)
  status           shipments_status
  product          String?          @db.VarChar(100)
  tags             String?          @db.VarChar(100)
  weight           String?          @db.VarChar(50)
  carrier          String?          @db.VarChar(100)
  carrier_id       String?          @db.VarChar(20)
  expected_arrival DateTime?        @db.DateTime(0)
  created_at       DateTime         @default(now()) @db.DateTime(0)
  quality_checks   quality_checks[]
  carriers         carriers?        @relation(fields: [carrier_id], references: [id])
  customers        customers?       @relation(fields: [customer_id], references: [id])

  @@index([customer_id], map: "customer_id_idx")
  @@index([carrier_id], map: "carrier_id_idx")
  @@map("shipments")
}

model suppliers {
  id                     String           @id @default(cuid()) @db.VarChar(20)
  name                   String           @db.VarChar(100)
  location               String?          @db.VarChar(100)
  contact_name           String?          @db.VarChar(100)
  contact_email          String?          @db.VarChar(100)
  contact_phone          String?          @db.VarChar(20)
  produce_types          String?          @db.LongText
  status                 suppliers_status
  logo_url               String?          @db.VarChar(255)
  active_contracts       Int?             @default(0)
  kra_pin                String?          @db.VarChar(20)
  supplier_code          String?          @unique @db.VarChar(20)
  vehicle_number_plate   String?          @db.VarChar(20)
  driver_name            String?          @db.VarChar(100)
  driver_id_number       String?          @db.VarChar(50)
  mpesa_paybill          String?          @db.VarChar(20)
  mpesa_account_number   String?          @db.VarChar(50)
  bank_name              String?          @db.VarChar(100)
  bank_account_number    String?          @db.VarChar(50)
  password               String?          @db.VarChar(255)
  created_at             DateTime         @default(now()) @db.DateTime(0)
  vehicle_status         String?          @default("Pre-registered") @db.VarChar(50)
  vehicle_check_in_time  DateTime?        @db.DateTime(0)
  vehicle_check_out_time DateTime?        @db.DateTime(0)
  vehicle_type           String?          @db.VarChar(50)
  cargo_description      String?          @db.LongText

  @@map("suppliers")
}

model visitors {
  id                     String    @id @default(cuid())
  visitor_code           String    @unique
  name                   String
  id_number              String?
  company                String?
  email                  String?
  phone                  String
  vehicle_plate          String?
  vehicle_type           String?
  cargo_description      String?
  visitor_type           String?   @default("visitor")
  status                 String?   @default("Pre-registered")
  check_in_time          DateTime?
  check_out_time         DateTime?
  expected_check_in_time DateTime?
  host_id                String?
  department             String?
  created_at             DateTime  @default(now())
  updated_at             DateTime  @updatedAt

  @@map("visitors")
}

model weight_entries {
  id               String              @id @default(uuid()) @db.VarChar(20)
  pallet_id        String?             @db.VarChar(100)
  product          String?             @db.VarChar(100)
  weight           Decimal?            @db.Decimal(10, 2)
  unit             weight_entries_unit
  timestamp        DateTime?           @db.DateTime(0)
  supplier         String?             @db.VarChar(100)
  truck_id         String?             @db.VarChar(100)
  driver_id        String?             @db.VarChar(100)
  gross_weight     Decimal?            @db.Decimal(10, 2)
  tare_weight      Decimal?            @db.Decimal(10, 2)
  net_weight       Decimal?            @db.Decimal(10, 2)
  declared_weight  Decimal?            @db.Decimal(10, 2)
  rejected_weight  Decimal?            @db.Decimal(10, 2)
  created_at       DateTime            @default(now()) @db.DateTime(0)
  supplier_id      String?             @db.VarChar(255)
  supplier_phone   String?             @db.VarChar(50)
  fruit_variety    String?             @default("[]") @db.Text
  number_of_crates Int?                @default(0)
  region           String?             @db.VarChar(100)
  image_url        String?             @db.Text
  driver_name      String?             @db.VarChar(255)
  driver_phone     String?             @db.VarChar(50)
  driver_id_number String?             @db.VarChar(100)
  vehicle_plate    String?             @db.VarChar(50)
  notes            String?             @db.Text
  counting_records CountingRecord[]
  quality_checks   quality_checks[]
}

model quality_checks {
  id                  String          @id @default(cuid()) @db.VarChar(20)
  shipment_id         String?         @db.VarChar(20)
  operator_id         String?         @db.VarChar(20)
  pallet_id           String?         @db.VarChar(100)
  product             String?         @db.VarChar(100)
  declared_weight     Decimal?        @db.Decimal(10, 2)
  net_weight          Decimal?        @db.Decimal(10, 2)
  rejected_weight     Decimal?        @db.Decimal(10, 2)
  accepted_weight     Decimal?        @db.Decimal(10, 2)
  fuerte_class1       Decimal?        @db.Decimal(5, 2)
  fuerte_class2       Decimal?        @db.Decimal(5, 2)
  fuerte_overall      Decimal?        @db.Decimal(5, 2)
  hass_class1         Decimal?        @db.Decimal(5, 2)
  hass_class2         Decimal?        @db.Decimal(5, 2)
  hass_overall        Decimal?        @db.Decimal(5, 2)
  arrival_temperature Decimal?        @db.Decimal(4, 1)
  driver_id           String?         @db.VarChar(100)
  truck_id            String?         @db.VarChar(100)
  packaging_status    String?         @default("accepted") @db.VarChar(50)
  freshness_status    String?         @default("accepted") @db.VarChar(50)
  seals_status        String?         @default("accepted") @db.VarChar(50)
  overall_status      String?         @default("approved") @db.VarChar(50)
  notes               String?         @db.Text
  processed_at        DateTime        @default(now()) @db.DateTime(0)
  processed_by        String          @db.VarChar(100)
  created_at          DateTime        @default(now()) @db.DateTime(0)
  weight_entry_id     String?         @db.VarChar(20)
  shipments           shipments?      @relation(fields: [shipment_id], references: [id])
  weight_entry        weight_entries? @relation(fields: [weight_entry_id], references: [id])

  @@index([shipment_id], map: "shipment_id_idx")
  @@index([weight_entry_id], map: "weight_entry_id_idx")
  @@map("quality_checks")
}

model CountingRecord {
  id                    String          @id @default(cuid())
  supplier_id           String?
  supplier_name         String
  supplier_phone        String?
  region                String?
  pallet_id             String
  total_weight          Float
  fuerte_4kg_class1     Int             @default(0)
  fuerte_4kg_class2     Int             @default(0)
  fuerte_4kg_total      Int             @default(0)
  fuerte_10kg_class1    Int             @default(0)
  fuerte_10kg_class2    Int             @default(0)
  fuerte_10kg_total     Int             @default(0)
  hass_4kg_class1       Int             @default(0)
  hass_4kg_class2       Int             @default(0)
  hass_4kg_total        Int             @default(0)
  hass_10kg_class1      Int             @default(0)
  hass_10kg_class2      Int             @default(0)
  hass_10kg_total       Int             @default(0)
  counting_data         String          @db.LongText
  submitted_at          DateTime        @default(now())
  processed_by          String
  notes                 String?
  for_coldroom          Boolean?        @default(false)
  loaded_to_coldroom_at DateTime?
  status                String?         @default("pending")  // CHANGED
  total_counted_weight  Float?
  totals                String?         @db.LongText
  weight_entry          weight_entries? @relation(fields: [supplier_id], references: [id], onDelete: Cascade)

  @@index([supplier_id])
  @@index([pallet_id])
  @@index([submitted_at])
  @@index([supplier_name])
  @@map("counting_records")
}

model RejectionRecord {
  id                    String   @id @default(cuid())
  supplier_id           String?
  supplier_name         String
  pallet_id             String
  region                String?
  total_intake_weight   Float
  total_counted_weight  Float
  total_rejected_weight Float
  weight_variance       Float
  variance_level        String
  crates                String?  @db.LongText
  notes                 String?
  counting_data         String?  @db.LongText
  counting_totals       String?  @db.LongText
  submitted_at          DateTime @default(now())
  processed_by          String
  original_counting_id  String?
  status                String?  @default("pending_coldroom")  // NEW

  @@index([supplier_name])
  @@index([pallet_id])
  @@index([submitted_at])
  @@index([status])  // NEW
  @@map("rejection_records")
}

model utility_readings {
  id             Int      @id @default(autoincrement())
  date           DateTime @default(now())
  powerOpening   String
  powerClosing   String
  powerConsumed  String
  waterOpening   String
  waterClosing   String
  waterConsumed  String
  generatorStart String
  generatorStop  String
  timeConsumed   String
  dieselConsumed String
  dieselRefill   String?
  recordedBy     String
  shift          String?
  notes          String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model cold_room_boxes {
  id                 String   @id @default(cuid())
  variety            String
  box_type           String
  size               String
  grade              String
  quantity           Int
  cold_room_id       String
  counting_record_id String?
  supplier_name      String?
  pallet_id          String?
  region             String?
  created_at         DateTime @default(now())

  @@index([cold_room_id])
  @@index([counting_record_id])
  @@index([supplier_name])
  @@map("cold_room_boxes")
}

model cold_room_pallets {
  id           String   @id @default(cuid())
  variety      String
  box_type     String
  size         String
  grade        String
  pallet_count Int      @default(0)
  cold_room_id String
  created_at   DateTime @default(now())
  last_updated DateTime @default(now())

  @@index([cold_room_id])
  @@map("cold_room_pallets")
}

model temperature_logs {
  id           String   @id @default(cuid())
  cold_room_id String
  temperature  Float
  timestamp    DateTime @default(now())
  recorded_by  String   @default("Warehouse Staff")

  @@index([cold_room_id])
  @@index([timestamp])
  @@map("temperature_logs")
}

model repacking_records {
  id             String   @id @default(cuid())
  cold_room_id   String
  removed_boxes  String   @db.LongText
  returned_boxes String   @db.LongText
  rejected_boxes Int      @default(0)
  notes          String?
  timestamp      DateTime @default(now())
  processed_by   String   @default("Warehouse Staff")

  @@index([cold_room_id])
  @@index([timestamp])
  @@map("repacking_records")
}

model loading_history {
  id            String   @id @default(cuid())
  pallet_id     String
  supplier_name String?
  cold_room_id  String?
  loaded_weight Float?
  loaded_by     String?
  loaded_at     DateTime @default(now())
  notes         String?
  box_id        String?
  box_type      String?
  grade         String?
  quantity      Int?
  region        String?
  size          String?
  variety       String?

  @@index([pallet_id])
  @@index([box_id])
  @@index([loaded_at])
  @@index([variety])
  @@index([box_type])
  @@map("loading_history")
}

model loading_sheets {
  id                  String                @id @default(cuid()) @db.VarChar(255)
  exporter            String                @db.VarChar(255)
  client              String                @db.VarChar(255)
  shipping_line       String                @db.VarChar(255)
  bill_number         String                @db.VarChar(100)
  container           String                @db.VarChar(100)
  seal1               String                @db.VarChar(100)
  seal2               String                @db.VarChar(100)
  truck               String                @db.VarChar(100)
  vessel              String                @db.VarChar(100)
  eta_msa             DateTime?
  etd_msa             DateTime?
  port                String                @db.VarChar(100)
  eta_port            DateTime?
  temp_rec1           String                @db.VarChar(50)
  temp_rec2           String                @db.VarChar(50)
  loading_date        DateTime
  loaded_by           String?               @db.VarChar(255)
  checked_by          String?               @db.VarChar(255)
  remarks             String?               @db.Text
  created_at          DateTime              @default(now())
  updated_at          DateTime              @updatedAt
  carrier_assignments carrier_assignments[]
  loading_pallets     loading_pallets[]

  @@map("loading_sheets")
}

model loading_pallets {
  id               String         @id @default(cuid()) @db.VarChar(255)
  loading_sheet_id String         @db.VarChar(255)
  pallet_no        Int
  temp             String?        @db.VarChar(50)
  trace_code       String?        @db.VarChar(100)
  size12           Int            @default(0)
  size14           Int            @default(0)
  size16           Int            @default(0)
  size18           Int            @default(0)
  size20           Int            @default(0)
  size22           Int            @default(0)
  size24           Int            @default(0)
  size26           Int            @default(0)
  size28           Int            @default(0)
  size30           Int            @default(0)
  total            Int            @default(0)
  loading_sheets   loading_sheets @relation(fields: [loading_sheet_id], references: [id], onDelete: Cascade)

  @@index([loading_sheet_id], map: "loading_pallets_loading_sheet_id_fkey")
  @@map("loading_pallets")
}

model carrier_assignments {
  id                   String            @id @default(cuid()) @db.VarChar(255)
  carrier_id           String            @db.VarChar(20)
  loading_sheet_id     String            @db.VarChar(255)
  assigned_at          DateTime          @default(now()) @db.DateTime(0)
  assigned_by          String            @db.VarChar(100)
  status               String            @default("assigned") @db.VarChar(50)
  notes                String?           @db.Text
  created_at           DateTime          @default(now()) @db.DateTime(0)
  transit_completed_at DateTime?         @db.DateTime(0)
  transit_days         Int?              @default(0)
  transit_started_at   DateTime?         @db.DateTime(0)
  carrier              carriers          @relation(fields: [carrier_id], references: [id], onDelete: Cascade)
  loading_sheet        loading_sheets    @relation(fields: [loading_sheet_id], references: [id], onDelete: Cascade)
  transit_history      transit_history[]

  @@unique([carrier_id, loading_sheet_id])
  @@index([loading_sheet_id], map: "carrier_assignments_loading_sheet_id_fkey")
  @@map("carrier_assignments")
}

model transit_history {
  id            String              @id @default(cuid()) @db.VarChar(255)
  assignment_id String              @db.VarChar(255)
  action        String              @db.VarChar(50)
  timestamp     DateTime            @default(now()) @db.DateTime(0)
  notes         String?             @db.Text
  location      String?             @db.VarChar(255)
  created_at    DateTime            @default(now()) @db.DateTime(0)
  assignment    carrier_assignments @relation(fields: [assignment_id], references: [id], onDelete: Cascade)

  @@index([assignment_id])
  @@index([action])
  @@index([timestamp])
  @@map("transit_history")
}

model packaging_materials {
  id              String   @id @default(cuid())
  name            String
  category        String
  unit            String
  currentStock    Int      @default(0)
  reorderLevel    Int      @default(10)
  dimensions      String?
  lastUsedDate    DateTime @default(now())
  consumptionRate String   @default("medium")
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  @@map("packaging_materials")
}

model User {
  id               String    @id @default(cuid())
  email            String    @unique
  name             String?
  password         String?
  roleId           String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  lastLogin        DateTime?
  lockedUntil      DateTime?
  loginAttempts    Int       @default(0)
  twoFactorEnabled Boolean   @default(false)
  twoFactorSecret  String?
  role             UserRole? @relation(fields: [roleId], references: [id])

  @@index([email])
  @@index([roleId])
  @@map("users")
}

model UserRole {
  id          String   @id @default(nanoid(8))
  name        String   @unique @db.VarChar(100)
  description String?  @db.Text
  permissions String   @db.LongText
  isDefault   Boolean  @default(false)
  createdAt   DateTime @default(now()) @db.DateTime(0)
  updatedAt   DateTime @updatedAt @db.DateTime(0)
  users       User[]

  @@index([isDefault])
  @@index([createdAt])
  @@map("user_roles")
}

enum carriers_status {
  Active
  Inactive
  Suspended
}

enum accounts_receivable_aging_status {
  On_Time
  At_Risk
  Late
}

enum activity_logs_status {
  success
  failure
  pending
}

enum cold_room_inventory_category {
  Fruit
  Vegetable
  Flower
  Other
}

enum cold_room_inventory_unit {
  pallets
  tonnes
  boxes
  crates
}

enum cold_rooms_status {
  Optimal
  Warning
  Alert
}

enum cold_rooms_zone_type {
  Fruit
  Vegetable
  Flower
}

enum customers_status {
  active
  inactive
  new
}

enum dwell_times_status {
  optimal
  moderate
  high
}

enum products_category {
  Fruit
  Vegetable
  Flower
  Other
}

enum quotes_status {
  Draft
  Sent
  Accepted
  Expired
}

enum shipments_status {
  Awaiting_QC
  Processing
  Receiving
  Preparing_for_Dispatch
  Ready_for_Dispatch
  In_Transit
  Delivered
  Delayed
}

enum suppliers_status {
  Active
  Inactive
  Onboarding
  Suspended
}

enum weight_entries_unit {
  kg
  lb
}
